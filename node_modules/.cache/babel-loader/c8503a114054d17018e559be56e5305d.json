{"ast":null,"code":"import _slicedToArray from\"/Users/taehyungkim/Desktop/self-study/project_picdiary_deploy/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState,useRef}from\"react\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PicAddStory=function PicAddStory(_ref){var data=_ref.data,content=_ref.content,setPicData=_ref.setPicData,picData=_ref.picData,date=_ref.date,options=_ref.options,newPicData=_ref.newPicData,rawData=_ref.rawData,isChanged=_ref.isChanged,setIsChanged=_ref.setIsChanged;var _useState=useState(\"활성화\"),_useState2=_slicedToArray(_useState,2),button=_useState2[0],setButton=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),text=_useState4[0],setText=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),readonly=_useState6[0],setRO=_useState6[1];var storyRef=useRef(null);var navigate=useNavigate();useEffect(function(){setText(data.text);storyRef.current.value=data.text;},[]);var setData=function setData(){// let picData_newText = picData.map((el) => {\n//   if (el.date === date) {\n//     let content_newText = [];\n//     el.content.forEach((content) => {\n//       if (content.date_id !== data.date_id) {\n//         content_newText.push(content);\n//       } else {\n//         content.text = text;\n//         content_newText.push(content);\n//       }\n//     });\n//     el.content = content_newText;\n//     return el;\n//   } else {\n//     return el;\n//   }\n// });\nrawData=rawData.map(function(el){if(el.date===date){var content_newText=[];el.content.forEach(function(content){if(content.date_id!==data.date_id){content_newText.push(content);}else{content.text=text;content_newText.push(content);}});el.content=content_newText;return el;}else{return el;}});fetch(\"http://localhost:3001/diary/\".concat(rawData[0].id),{method:\"PUT\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(rawData[0])});};var onButton=function onButton(e){if(button===\"활성화\"){setButton(\"비활성화\");setRO(false);}else{setButton(\"활성화\");setRO(true);setData();setIsChanged(!isChanged);}};var onMouseDown=function onMouseDown(){if(readonly===true)alert(\"글을 수정하려면 하단 버튼을 클릭하여서 수정모드로 변환해주세요.\");};var onContentDeleteClick=function onContentDeleteClick(){storyRef.current.value=\"\";setText(\"\");};var onDeleteClick=function onDeleteClick(e){// let temp = picData;\n// temp.map((el) => {\n//   if (el.date === date) {\n//     el.content = el.content.filter(\n//       (content) => content.text !== storyRef.current.value\n//     );\n//     console.log(el, \"chagne\");\n//   }\n// });\n// setPicData(temp);\nif(rawData[0].content.length===1){fetch(\"http://localhost:3001/diary/\".concat(rawData[0].id),{method:\"DELETE\"}).then(function(res){navigate(\"/add/\");});}else{rawData[0].content=rawData[0].content.filter(function(el){return el.date_id!==data.date_id;});fetch(\"http://localhost:3001/diary/\".concat(rawData[0].id),{method:\"PUT\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(rawData[0])}).then(function(res){setIsChanged(!isChanged);});}};var handleCategory=function handleCategory(e){// let picData_newCategory = picData.map((el) => {\n//   if (el.date === date) {\n//     let content_newCategory = [];\n//     el.content.forEach((content) => {\n//       if (content.text !== storyRef.current.value) {\n//         content_newCategory.push(content);\n//       } else {\n//         if (e.target.value === \"---\") {\n//           delete content.category;\n//         } else {\n//           content.category = e.target.value;\n//         }\n//         content_newCategory.push(content);\n//       }\n//     });\n//     el.content = content_newCategory;\n//     return el;\n//   } else {\n//     return el;\n//   }\n// });\n// setPicData(picData_newCategory);\ne.target.value===\"---\"?delete data.category:data.category=e.target.value;setData();};var onChange=function onChange(e){setText(e.target.value);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{className:\"storyWrapper\",type:\"text\",ref:storyRef,value:text,readOnly:readonly,onMouseDown:onMouseDown,onChange:onChange}),button===\"비활성화\"?/*#__PURE__*/_jsx(\"select\",{onChange:handleCategory,children:options.map(function(el){return/*#__PURE__*/_jsx(_Fragment,{children:data.category===el?/*#__PURE__*/_jsx(\"option\",{selected:true,value:el,children:el}):/*#__PURE__*/_jsx(\"option\",{value:el,children:el})});})}):null,/*#__PURE__*/_jsx(\"button\",{onClick:onButton,children:button}),button===\"비활성화\"?/*#__PURE__*/_jsx(\"button\",{onClick:onContentDeleteClick,children:\"\\uC804\\uCCB4 \\uB0B4\\uC6A9 \\uC0AD\\uC81C\\uD558\\uAE30\"}):null,button===\"비활성화\"?/*#__PURE__*/_jsx(\"button\",{onClick:onDeleteClick,children:\"\\uD574\\uB2F9 \\uC0AC\\uC9C4 \\uC0AD\\uC81C\\uD558\\uAE30\"}):null]});};export default PicAddStory;","map":{"version":3,"names":["React","useEffect","useState","useRef","useNavigate","PicAddStory","data","content","setPicData","picData","date","options","newPicData","rawData","isChanged","setIsChanged","button","setButton","text","setText","readonly","setRO","storyRef","navigate","current","value","setData","map","el","content_newText","forEach","date_id","push","fetch","id","method","headers","body","JSON","stringify","onButton","e","onMouseDown","alert","onContentDeleteClick","onDeleteClick","length","then","res","filter","handleCategory","target","category","onChange"],"sources":["/Users/taehyungkim/Desktop/self-study/project_picdiary_deploy/src/components/PicAddStory.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n\nconst PicAddStory = ({\n  data,\n  content,\n  setPicData,\n  picData,\n  date,\n  options,\n  newPicData,\n  rawData,\n  isChanged,\n  setIsChanged,\n}) => {\n  const [button, setButton] = useState(\"활성화\");\n  const [text, setText] = useState(\"\");\n  const [readonly, setRO] = useState(true);\n  const storyRef = useRef(null);\n  let navigate = useNavigate();\n  useEffect(() => {\n    setText(data.text);\n    storyRef.current.value = data.text;\n  }, []);\n  const setData = () => {\n    // let picData_newText = picData.map((el) => {\n    //   if (el.date === date) {\n    //     let content_newText = [];\n    //     el.content.forEach((content) => {\n    //       if (content.date_id !== data.date_id) {\n    //         content_newText.push(content);\n    //       } else {\n    //         content.text = text;\n    //         content_newText.push(content);\n    //       }\n    //     });\n    //     el.content = content_newText;\n    //     return el;\n    //   } else {\n    //     return el;\n    //   }\n    // });\n    rawData = rawData.map((el) => {\n      if (el.date === date) {\n        let content_newText = [];\n        el.content.forEach((content) => {\n          if (content.date_id !== data.date_id) {\n            content_newText.push(content);\n          } else {\n            content.text = text;\n            content_newText.push(content);\n          }\n        });\n        el.content = content_newText;\n        return el;\n      } else {\n        return el;\n      }\n    });\n    fetch(`http://localhost:3001/diary/${rawData[0].id}`, {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(rawData[0]),\n    });\n  };\n\n  const onButton = (e) => {\n    if (button === \"활성화\") {\n      setButton(\"비활성화\");\n      setRO(false);\n    } else {\n      setButton(\"활성화\");\n      setRO(true);\n      setData();\n      setIsChanged(!isChanged);\n    }\n  };\n\n  const onMouseDown = () => {\n    if (readonly === true)\n      alert(\"글을 수정하려면 하단 버튼을 클릭하여서 수정모드로 변환해주세요.\");\n  };\n\n  const onContentDeleteClick = () => {\n    storyRef.current.value = \"\";\n    setText(\"\");\n  };\n\n  const onDeleteClick = (e) => {\n    // let temp = picData;\n    // temp.map((el) => {\n    //   if (el.date === date) {\n    //     el.content = el.content.filter(\n    //       (content) => content.text !== storyRef.current.value\n    //     );\n    //     console.log(el, \"chagne\");\n    //   }\n    // });\n    // setPicData(temp);\n    if (rawData[0].content.length === 1) {\n      fetch(`http://localhost:3001/diary/${rawData[0].id}`, {\n        method: \"DELETE\",\n      }).then((res) => {\n        navigate(\"/add/\");\n      });\n    } else {\n      rawData[0].content = rawData[0].content.filter(\n        (el) => el.date_id !== data.date_id\n      );\n      fetch(`http://localhost:3001/diary/${rawData[0].id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(rawData[0]),\n      }).then((res) => {\n        setIsChanged(!isChanged);\n      });\n    }\n  };\n\n  const handleCategory = (e) => {\n    // let picData_newCategory = picData.map((el) => {\n    //   if (el.date === date) {\n    //     let content_newCategory = [];\n    //     el.content.forEach((content) => {\n    //       if (content.text !== storyRef.current.value) {\n    //         content_newCategory.push(content);\n    //       } else {\n    //         if (e.target.value === \"---\") {\n    //           delete content.category;\n    //         } else {\n    //           content.category = e.target.value;\n    //         }\n    //         content_newCategory.push(content);\n    //       }\n    //     });\n    //     el.content = content_newCategory;\n    //     return el;\n    //   } else {\n    //     return el;\n    //   }\n    // });\n    // setPicData(picData_newCategory);\n    e.target.value === \"---\"\n      ? delete data.category\n      : (data.category = e.target.value);\n    setData();\n  };\n\n  const onChange = (e) => {\n    setText(e.target.value);\n  };\n\n  return (\n    <>\n      <input\n        className=\"storyWrapper\"\n        type=\"text\"\n        ref={storyRef}\n        value={text}\n        readOnly={readonly}\n        onMouseDown={onMouseDown}\n        onChange={onChange}\n      ></input>\n      {button === \"비활성화\" ? (\n        <select onChange={handleCategory}>\n          {options.map((el) => {\n            return (\n              <>\n                {data.category === el ? (\n                  <option selected value={el}>\n                    {el}\n                  </option>\n                ) : (\n                  <option value={el}>{el}</option>\n                )}\n              </>\n            );\n          })}\n        </select>\n      ) : null}\n      <button onClick={onButton}>{button}</button>\n      {button === \"비활성화\" ? (\n        <button onClick={onContentDeleteClick}>전체 내용 삭제하기</button>\n      ) : null}\n      {button === \"비활성화\" ? (\n        <button onClick={onDeleteClick}>해당 사진 삭제하기</button>\n      ) : null}\n    </>\n  );\n};\n\nexport default PicAddStory;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}